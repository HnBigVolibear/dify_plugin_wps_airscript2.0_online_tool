
from collections.abc import Generator
from typing import Any

from dify_plugin import Tool
from dify_plugin.entities.tool import ToolInvokeMessage

from wps_airscript_client import WPSAirScriptClient

help_info_md = '''
# è®¾ç½®ç­›é€‰ å‡½æ•°ä½¿ç”¨è¯´æ˜

## æ¦‚è¿°
`è®¾ç½®ç­›é€‰` å‡½æ•°ç”¨äºåœ¨ WPSåœ¨çº¿æ™ºèƒ½è¡¨æ ¼ä¸­ï¼Œå¯¹æŒ‡å®šå·¥ä½œè¡¨è¿›è¡Œè‡ªåŠ¨æ•°æ®ç­›é€‰ï¼Œæ”¯æŒå¤šç§ç­›é€‰æ–¹å¼ã€é€»è¾‘ä¸æˆ–ç»„åˆã€é€šé…ç¬¦åŒ¹é…åŠé¢œè‰²ç­›é€‰ç­‰å¤æ‚åœºæ™¯ã€‚

## å‡½æ•°åº•å±‚å®ç°
```javascript
setFilter(field, operatorStr, criteria1, criteria2, is_reSet, sheetName)
```

## å‚æ•°è¯´æ˜

| å‚æ•°å | ä¸­æ–‡å | å¿…å¡« | è¯´æ˜ |
|--------|------|------|------|
| `field` | ç­›é€‰å­—æ®µ(ç¬¬å‡ åˆ—) | æ˜¯ | **åˆ—å·**ï¼ˆä»1å¼€å§‹ï¼‰<br>â€¢ ç¬¬1åˆ— = 1<br>â€¢ ç¬¬2åˆ— = 2<br>â€¢ æ•´æ•°ç±»å‹ã€‚ä¸è¦ä½¿ç”¨å­—æ¯ï¼ˆå¦‚"A"ï¼‰ |
| `operatorStr` | æ“ä½œç¬¦æ–¹å¼ | æ˜¯ | **æ”¯æŒä»¥ä¸‹å¤šç§ç­›é€‰æ“ä½œæ–¹å¼ï¼š**<br>â€¢ `"xlFilterValues"` - å€¼ç­›é€‰ã€‚å³é»˜è®¤æ–¹å¼ï¼ŒæŒ‰å†…å®¹ç­›é€‰ã€‚<br>â€¢ `"xlAnd"` - é€»è¾‘ä¸ï¼ˆAä¸”Bï¼‰<br>â€¢ `"xlOr"` - é€»è¾‘æˆ–ï¼ˆAæˆ–Bï¼‰<br>â€¢ `"xlTop10Items"` - å‰Né¡¹<br>â€¢ `"xlTop10Percent"` - å‰N%<br>â€¢ `"xlBottom10Items"` - åNé¡¹<br>â€¢ `"xlBottom10Percent"` - åN%<br>â€¢ `"xlFilterCellColor"` - æŒ‰å•å…ƒæ ¼é¢œè‰²<br>â€¢ `"xlFilterFontColor"` - æŒ‰å­—ä½“é¢œè‰² |
| `criteria1` | ç­›é€‰æ¡ä»¶1 | æ˜¯ | **ç¬¬ä¸€ä¸ªç­›é€‰æ¡ä»¶ï¼ˆæ”¯æŒé€šé…ç¬¦ï¼‰**<br>â€¢ ç²¾ç¡®å€¼ï¼š`"å·²å®Œæˆ"`<br>â€¢ æ¯”è¾ƒç¬¦ï¼š`">60"`ã€`"=20"`ã€`"<>5"`<br>â€¢ é€šé…ç¬¦ï¼š`"å¼ *"`ã€`"æ??"`ã€`"*éƒ¨é—¨?"` |
| `criteria2` | ç­›é€‰æ¡ä»¶2 | å¦ | **ç¬¬äºŒä¸ªç­›é€‰æ¡ä»¶ï¼ˆæ”¯æŒé€šé…ç¬¦ï¼‰**<br>â€¢ å¯é€‰ï¼ä»…å½“ `operatorStr` ä¸º `"xlAnd"` æˆ– `"xlOr"` æ—¶ä½¿ç”¨ <br>â€¢ ä¸å¡«æ—¶ï¼Œåˆ™åªæœ‰ç­›é€‰æ¡ä»¶1ç”Ÿæ•ˆã€‚ |
| `is_reSet` | æ˜¯å¦é‡ç½®ç­›é€‰ | æ˜¯ | **æ˜¯å¦é‡ç½®ç­›é€‰**<br>â€¢ `æ˜¯` - æ¸…é™¤æ‰€æœ‰æ—§ç­›é€‰ï¼Œåº”ç”¨æ–°æ¡ä»¶<br>â€¢ `å¦` - åœ¨ç°æœ‰ç­›é€‰ä¸Šå åŠ ç­›é€‰æ¡ä»¶ã€‚<br>â€¢ æ¯”å¦‚ï¼šä½ è¦å¯¹ä¸¤åˆ—éƒ½è¿›è¡Œç­›é€‰æ—¶ï¼Œå°±éœ€è¦å…³é—­æœ¬å¼€å…³ï¼Œç„¶åå…ˆåæ‰§è¡Œä¸¤æ¬¡æœ¬æ–¹æ³•ï¼<br>â€¢ ä¸€èˆ¬éƒ½æ˜¯å»ºè®®ç›´æ¥ä½¿ç”¨ `æ˜¯` |
| `sheetName` | å·¥ä½œè¡¨ | æ˜¯ | **å·¥ä½œè¡¨åç§°** ç¡®ä¿å¡«å…¥æ­£ç¡®çš„Sheetè¡¨æ ¼åç§° |

 âš ï¸ **ã€ç‰¹åˆ«è¯´æ˜ã€‘** å½“ä½ é€‰`xlAnd`æˆ–`xlOr`ã€ä½†æ˜¯å´æ²¡å¡«`æ¡ä»¶2`æ—¶ï¼Œåˆ™å®é™…ä¸Šå°±ç­‰åŒäºè¿™ä¸ª`xlFilterValueså€¼ç­›é€‰`ï¼

## ğŸ“Œ é€šé…ç¬¦ä½¿ç”¨ï¼ˆæ— éœ€åŠ  `=` å·å‰ç¼€ï¼ŒåŠ äº†ä¹Ÿæ²¡äº‹ï¼‰

| é€šé…ç¬¦ | å«ä¹‰ | ç¤ºä¾‹ | æ•ˆæœ |
|--------|------|------|------|
| `*` | ä»»æ„æ•°é‡å­—ç¬¦ | â€¢ `"å¼ *"`<br>â€¢ `"*ç­é•¿*"` | â€¢ åŒ¹é…"å¼ ä¸‰"ã€"å¼ ä¼Ÿä¸°"ç­‰å§“å¼ çš„<br>â€¢ åŒ¹é…"å¼ ç­é•¿"ã€"ç­é•¿å¥½"ã€"æ‰¾ç­é•¿å»å§"è¿™æ ·çš„ |
| `?` | å•ä¸ªå­—ç¬¦ | â€¢ `"æ?æ˜"`<br>â€¢ `"æ??"` | â€¢ åŒ¹é…"ææ™“æ˜"å’Œ"æå¿—æ˜"ï¼Œä¸åŒ¹é…"æå¤§å¿—"å’Œ"æå¤§å¿—æ˜"<br>â€¢ åŒ¹é…"ææ™“æ˜"å’Œ"æå¿—æ˜"å’Œ"æå¤§å¿—"ï¼Œä¸åŒ¹é…"æå¤§å¿—æ˜" |

## ğŸš€ å¼ºå¤§ç¤ºä¾‹å¤§å…¨

### 1. åŸºç¡€æ–‡æœ¬ç­›é€‰
```javascript
// ç²¾ç¡®åŒ¹é…å§“å"å¼ ä¸‰"
setFilter(1, 'xlAnd', 'å¼ ä¸‰', null, true, 'å‘˜å·¥è¡¨');
// ç²¾ç¡®åŒ¹é…æ•°å­—"20"
setFilter(1, 'xlAnd', '20', null, true, 'å‘˜å·¥è¡¨');
// æˆ– setFilter(1, 'xlAnd', '=20', null, true, 'å‘˜å·¥è¡¨');

// ç­›é€‰æ‰€æœ‰å§“"ç‹"çš„å‘˜å·¥
setFilter(1, 'xlAnd', 'ç‹*', null, true, 'å‘˜å·¥è¡¨');

// ç­›é€‰å§“åä»¥"æ˜"ç»“å°¾çš„å‘˜å·¥
setFilter(1, 'xlAnd', '*æ˜', null, true, 'å‘˜å·¥è¡¨');

// ç­›é€‰å§“ååŒ…å«"å»ºå›½"çš„å‘˜å·¥
setFilter(1, 'xlAnd', '*å»ºå›½*', null, true, 'å‘˜å·¥è¡¨');
```

### 2. é€šé…ç¬¦é«˜çº§ç»„åˆ
```javascript
// ç²¾ç¡®3ä¸ªå­—ï¼Œä¸­é—´ä¸º"å°"çš„å§“åï¼ˆå¦‚ï¼šç‹å°åï¼‰
setFilter(1, 'xlAnd', '?å°?', null, true, 'å§“åè¡¨');

// ç¬¬äºŒä¸ªå­—æ˜¯"å°"å­—çš„ï¼ˆå¦‚ï¼šç‹å°åå»å“ªäº†ï¼‰
setFilter(1, 'xlAnd', '?å°*', null, true, 'å§“åè¡¨');

// ç­›é€‰ç¬¬2åˆ—ä»¥"äº§å“"å¼€å¤´ä¸”ä»¥"éƒ¨"ç»“å°¾çš„éƒ¨é—¨
setFilter(2, 'xlAnd', 'äº§å“*éƒ¨', null, true, 'ç»„ç»‡è¡¨');

// ç­›é€‰ç¬¬3åˆ—å›ºå®šæ ¼å¼çš„ç¼–å·ï¼šAB-å¼€å¤´ï¼Œä¸­é—´ä»»æ„ï¼Œ-2024ç»“å°¾
setFilter(3, 'xlAnd', 'AB-*-2024', null, true, 'è®¢å•è¡¨');

// ç­›é€‰ç¬¬4åˆ—é‚®ç®±ä¸ºgmail.comç»“å°¾çš„æ‰€æœ‰åœ°å€
setFilter(4, 'xlAnd', '*@gmail.com', null, true, 'è”ç³»äººè¡¨');

// è¿˜å¯ä»¥æ›´å¤æ‚çš„ï¼ˆå¦‚åŒ¹é…ï¼šå¼ å°èŠ±ä»Šå¤©ä¸Šç­äº†å—ï¼‰
setFilter(1, 'xlAnd', 'å¼ ??ä»Šå¤©*å—', null, true, 'å§“åè¡¨');
```

### 3. é€»è¾‘ä¸ï¼ˆxlAndï¼‰å¤æ‚åœºæ™¯
```javascript
// ç­›é€‰å§“åå§“"æ"ä¸”åŒ…å«"å"å­—çš„è®°å½•
setFilter(1, 'xlAnd', 'æ*', '*å*', true, 'å‘˜å·¥è¡¨');

// ç­›é€‰æ‰‹æœºå·ä»¥"138"å¼€å¤´ä¸”ä»¥"8888"ç»“å°¾
setFilter(2, 'xlAnd', '138*', '*8888', true, 'å®¢æˆ·è¡¨');

// ç­›é€‰é‡‘é¢å¤§äº1000ä¸”å°äº5000çš„è®°å½•
setFilter(3, 'xlAnd', '>1000', '<5000', true, 'è´¢åŠ¡è¡¨');

// ç­›é€‰æ—¥æœŸåœ¨2024å¹´1æœˆåˆ°3æœˆçš„è®°å½•
setFilter(4, 'xlAnd', '>=2024/1/1', '<=2024/3/31', true, 'æ—¥ç¨‹è¡¨');

// ç­›é€‰çŠ¶æ€ä¸ä¸º"å·²å–æ¶ˆ"ä¸”é‡‘é¢å¤§äº0çš„è®°å½•
setFilter(5, 'xlAnd', '<>å·²å–æ¶ˆ', '>0', true, 'è®¢å•è¡¨');
```

### 4. é€»è¾‘æˆ–ï¼ˆxlOrï¼‰çµæ´»ç»„åˆ
```javascript
// ç­›é€‰å¤šä¸ªç‰¹å®šå§“åï¼šå¼ ä¸‰ã€æå››ã€ç‹äº”
setFilter(1, 'xlOr', 'å¼ ä¸‰', 'æå››', true, 'åå•è¡¨');
// é…åˆå¤šæ¬¡è°ƒç”¨å®ç°æ›´å¤šæ¡ä»¶

// ç­›é€‰å¤šä¸ªéƒ¨é—¨ï¼šé”€å”®éƒ¨ã€å¸‚åœºéƒ¨ã€è¿è¥éƒ¨
setFilter(2, 'xlOr', '*é”€å”®éƒ¨', '*å¸‚åœºéƒ¨', true, 'å‘˜å·¥è¡¨');

// ç­›é€‰å¤šä¸ªåŸå¸‚ï¼šåŒ—äº¬ã€ä¸Šæµ·ã€å¹¿å·ã€æ·±åœ³å¼€å¤´çš„åœ°å€
setFilter(3, 'xlOr', 'åŒ—äº¬*', 'ä¸Šæµ·*', true, 'åœ°å€è¡¨');
// å¯å†æ¬¡è°ƒç”¨æ·»åŠ æ›´å¤šåŸå¸‚

// ç­›é€‰å¤šä¸ªçŠ¶æ€ï¼šå·²å®Œæˆã€è¿›è¡Œä¸­ã€å¾…å®¡æ ¸
setFilter(4, 'xlOr', 'å·²å®Œæˆ', 'è¿›è¡Œä¸­', true, 'ä»»åŠ¡è¡¨');

// ç­›é€‰å¤šä¸ªåŒºåŸŸï¼šååŒ—ã€åä¸œã€åå—
setFilter(5, 'xlOr', '*ååŒ—*', '*åä¸œ*', true, 'åŒºåŸŸè¡¨');
```

### 5. é€šé…ç¬¦ä¸é€»è¾‘è¿ç®—ç»“åˆ
```javascript
// é«˜çº§ç­›é€‰ï¼šç­›é€‰å§“"å¼ "æˆ–å§“"ç‹"ä¸”åå­—åŒ…å«"ä¼Ÿ"çš„å‘˜å·¥
// æ–¹æ³•1ï¼šä½¿ç”¨é€šé…ç¬¦ç»„åˆ
setFilter(1, 'xlOr', 'å¼ *ä¼Ÿ*', 'ç‹*ä¼Ÿ*', true, 'å‘˜å·¥è¡¨');

// ç­›é€‰ç¼–å·ä»¥"A"æˆ–"B"å¼€å¤´ï¼Œä¸”ä»¥"-001"ç»“å°¾çš„è®°å½•
setFilter(2, 'xlOr', 'A*-001', 'B*-001', true, 'äº§å“è¡¨');

// ç­›é€‰é‚®ç®±ä¸ºgmail.comæˆ–163.comç»“å°¾çš„è”ç³»äºº
setFilter(3, 'xlOr', '*@gmail.com', '*@163.com', true, 'é‚®ç®±è¡¨');

// ç­›é€‰ç”µè¯å·ç ä»¥138ã€139ã€158å¼€å¤´çš„è®°å½•
setFilter(4, 'xlOr', '138*', '139*', true, 'é€šè®¯å½•');
// å¯å†æ¬¡è°ƒç”¨æ·»åŠ 158å¼€å¤´

// ç­›é€‰æ–‡ä»¶åä¸º.pdfæˆ–.docxç»“å°¾çš„æ–‡æ¡£
setFilter(5, 'xlOr', '*.pdf', '*.docx', true, 'æ–‡æ¡£è¡¨');
```

### 6. æ’é™¤å’Œåå‘ç­›é€‰
```javascript
// ç­›é€‰é™¤"æµ‹è¯•éƒ¨"å¤–çš„æ‰€æœ‰éƒ¨é—¨
setFilter(2, 'xlAnd', '<>æµ‹è¯•éƒ¨', null, true, 'éƒ¨é—¨è¡¨');

// ç­›é€‰é™¤å§“"å¼ "å’Œå§“"ç‹"å¤–çš„æ‰€æœ‰å‘˜å·¥
setFilter(1, 'xlAnd', '<>å¼ *', '<>ç‹*', true, 'å‘˜å·¥è¡¨');

// ç­›é€‰çŠ¶æ€ä¸æ˜¯"å·²å®Œæˆ"ä¹Ÿä¸æ˜¯"å·²å–æ¶ˆ"çš„ä»»åŠ¡
setFilter(3, 'xlAnd', '<>å·²å®Œæˆ', '<>å·²å–æ¶ˆ', true, 'ä»»åŠ¡è¡¨');

// ç­›é€‰é‡‘é¢ä¸ä¸º0ä¸”ä¸ä¸ºç©ºçš„è®°å½•
setFilter(4, 'xlAnd', '<>0', '<>', true, 'è´¢åŠ¡è¡¨');
```

### 7. æ•°å€¼èŒƒå›´ç­›é€‰
```javascript
// ç­›é€‰æˆç»©åœ¨60-80åˆ†ä¹‹é—´ï¼ˆåŒ…å«60å’Œ80ï¼‰
setFilter(1, 'xlAnd', '>=60', '<=80', true, 'æˆç»©è¡¨');

// ç­›é€‰å¹´é¾„å¤§äº18ä¸”å°äº60
setFilter(2, 'xlAnd', '>18', '<60', true, 'å¹´é¾„è¡¨');

// ç­›é€‰é”€å”®é¢åœ¨10000åˆ°50000ä¹‹é—´
setFilter(3, 'xlAnd', '>=10000', '<=50000', true, 'é”€å”®è¡¨');

// ç­›é€‰æ•°é‡ä¸ç­‰äº100ä¸”å¤§äº0
setFilter(4, 'xlAnd', '<>100', '>0', true, 'åº“å­˜è¡¨');
```

### 8. å‰Né¡¹å’Œç™¾åˆ†æ¯”ç­›é€‰
```javascript
// ç­›é€‰é”€å”®é¢æœ€é«˜çš„å‰5å
setFilter(1, 'xlTop10Items', '5', null, true, 'é”€å”®æ’åè¡¨');

// ç­›é€‰æˆç»©æœ€ä½çš„10åå­¦ç”Ÿ
setFilter(2, 'xlBottom10Items', '10', null, true, 'æˆç»©è¡¨');

// ç­›é€‰å‰20%çš„ä¼˜ç§€å‘˜å·¥
setFilter(3, 'xlTop10Percent', '20', null, true, 'ç»©æ•ˆè¡¨');

// ç­›é€‰å15%éœ€è¦æ”¹è¿›çš„å‘˜å·¥
setFilter(4, 'xlBottom10Percent', '15', null, true, 'è¯„ä¼°è¡¨');
```

### 9. é¢œè‰²ç­›é€‰
```javascript
// ç­›é€‰ç¬¬5åˆ—èƒŒæ™¯ä¸ºçº¢è‰²çš„å•å…ƒæ ¼
setFilter(5, 'xlFilterCellColor', '#FF0000', null, true, 'çŠ¶æ€è¡¨');

// ç­›é€‰ç¬¬6åˆ—å­—ä½“ä¸ºè“è‰²çš„è®°å½•
setFilter(6, 'xlFilterFontColor', '#0000FF', null, true, 'å¤‡æ³¨è¡¨');

// ç­›é€‰ç¬¬7åˆ—èƒŒæ™¯ä¸ºé»„è‰²çš„å¾…åŠäº‹é¡¹
setFilter(7, 'xlFilterCellColor', '#FFFF00', null, true, 'å¾…åŠè¡¨');

// ç­›é€‰ç¬¬8åˆ—å­—ä½“ä¸ºç»¿è‰²çš„å®Œæˆé¡¹
setFilter(8, 'xlFilterFontColor', '#00FF00', null, true, 'è¿›åº¦è¡¨');
```

### 10. å®é™…ä¸šåŠ¡åœºæ™¯ç»„åˆ
```javascript
// åœºæ™¯1ï¼šç­›é€‰2024å¹´1æœˆåä¸œåœ°åŒºé”€å”®é¢å¤§äº10000çš„è®¢å•
// å…ˆç­›é€‰æ—¥æœŸ
setFilter(1, 'xlAnd', '>=2024/1/1', '<=2024/1/31', true, 'è®¢å•è¡¨');
// å†ç­›é€‰åœ°åŒºï¼ˆæ³¨æ„ï¼šæ­¤æ—¶is_reSetè®¾ä¸ºfalseï¼Œåœ¨å·²æœ‰ç­›é€‰ä¸Šå åŠ ï¼‰
setFilter(2, 'xlOr', '*åä¸œ*', '*ä¸Šæµ·*', false, 'è®¢å•è¡¨');
// æœ€åç­›é€‰é”€å”®é¢
setFilter(3, 'xlAnd', '>10000', null, false, 'è®¢å•è¡¨');

// åœºæ™¯2ï¼šç­›é€‰VIPå®¢æˆ·ä¸”æœ€è¿‘30å¤©æœ‰è´­ä¹°è®°å½•çš„
setFilter(1, 'xlAnd', 'VIPå®¢æˆ·', null, true, 'å®¢æˆ·è¡¨');
setFilter(6, 'xlAnd', '>=2024/1/10', null, false, 'å®¢æˆ·è¡¨'); // å‡è®¾ç¬¬6åˆ—æ˜¯æœ€åè´­ä¹°æ—¥æœŸ

// åœºæ™¯3ï¼šç­›é€‰å¾…å‘è´§ä¸”é‡‘é¢å¤§äº500çš„è®¢å•
setFilter(1, 'xlAnd', 'å¾…å‘è´§', null, true, 'è®¢å•è¡¨');
setFilter(3, 'xlAnd', '>500', null, false, 'è®¢å•è¡¨');
```

## âš ï¸ é‡è¦æ³¨æ„äº‹é¡¹

1. **åˆ—å·å¿…é¡»ç”¨æ•°å­—**ï¼šå§‹ç»ˆä½¿ç”¨ `1, 2, 3...`ï¼Œä¸è¦ç”¨ `"A", "B", "C"`ã€‚
2. **é€šé…ç¬¦è‡ªåŠ¨å¤„ç†**ï¼šç›´æ¥å†™ `"*å¼ *"`ï¼Œæ— éœ€åŠ  `=` å·ã€‚å½“ç„¶ä½ åŠ ä¸Šä¹Ÿè¡Œï¼Œåæ­£ä¼šæ™ºèƒ½å¤„ç†ã€‚
3. **é‡ç½®å»ºè®®**ï¼šæ–°ç­›é€‰ä»»åŠ¡å»ºè®®è®¾ç½® `is_reSet: true`ï¼Œç»„åˆç­›é€‰æ—¶åç»­è°ƒç”¨ç”¨ `false`ã€‚
4. **é¢œè‰²æ ¼å¼**ï¼šæ”¯æŒåå…­è¿›åˆ¶é¢œè‰²ä»£ç ï¼ˆå¦‚ `"#FF0000"`ï¼‰ã€‚
5. **å‚æ•°é¡ºåº**ï¼šå¿…é¡»ä¸¥æ ¼æŒ‰å‡½æ•°ç­¾åé¡ºåºä¼ å…¥ã€‚
6. **é€šé…ç¬¦ä½ç½®çµæ´»**ï¼šå¯æ”¾åœ¨å¼€å¤´ã€ä¸­é—´ã€ç»“å°¾æˆ–ç»„åˆä½¿ç”¨ã€‚

## ğŸ¯ æç¤º
â€¢ ç­›é€‰æ“ä½œä¼šç«‹å³ç”Ÿæ•ˆï¼Œæ— éœ€é¢å¤–åˆ·æ–°å·¥ä½œè¡¨ã€‚çµæ´»ç»„åˆé€šé…ç¬¦å’Œé€»è¾‘è¿ç®—ç¬¦ï¼Œå¯ä»¥å®ç°å‡ ä¹æ‰€æœ‰å¸¸è§çš„ç­›é€‰éœ€æ±‚ï¼
â€¢ æœ¬å‘½ä»¤æ–¹æ³•ï¼Œä¸€æ¬¡åªèƒ½å¯¹**æŸä¸€åˆ—**è¿›è¡Œç­›é€‰ï¼
â€¢ å¦‚æœä½ è¦åŒæ—¶ç­›é€‰å¤šåˆ—ï¼Œæ¯”å¦‚ç­›é€‰Aåˆ—å•ä½ã€Båˆ—éƒ¨é—¨ï¼Œåˆ™å…ˆåå¯¹Aåˆ—å’ŒBåˆ—å„ç”¨ä¸€æ¬¡æœ¬æ–¹æ³•å³å¯ï¼ä½†æ˜¯åˆ‡è®°ï¼Œæ­¤ç§æƒ…å†µä¸€å®šè¦ç¡®ä¿å…³é—­is_reSetï¼ˆ**æ˜¯å¦é‡ç½®ç­›é€‰** = å¦ï¼‰ï¼
â€¢ é‡åˆ°é—®é¢˜ï¼Œå¯ä»¥å…ˆè‡ªå·±æ€è€ƒæ‹ä¸€ä¸‹ï¼Œæˆ–è€…æˆªå›¾ä¸¢ç»™AIé—®ä¸€ä¸‹ã€‚æˆ‘çš„å‘½ä»¤æ–¹æ³•ä¸€èˆ¬æ˜¯æ²¡é—®é¢˜çš„ï¼

'''

class test_set_filter(Tool):
    def _invoke(self, tool_parameters: dict[str, Any]) -> Generator[ToolInvokeMessage]:
        help_info = tool_parameters.get("help_info", "å¦")=="æ˜¯"
        if help_info:
            yield self.create_text_message(help_info_md)
            return

        field = tool_parameters.get("field", 1)
        operator = tool_parameters.get("operator", "xlFilterValues")
        criteria1 = tool_parameters.get("criteria1", "")
        criteria2 = tool_parameters.get("criteria2", "")
        is_reSet = tool_parameters.get("is_reSet", "æ˜¯")=="æ˜¯"
        sheet_name = tool_parameters.get("sheet_name", None)

        if not field or field <= 0:
            raise Exception("è¯·å¡«å…¥ç­›é€‰å­—æ®µï¼ˆç¬¬å‡ åˆ—ï¼‰ï¼Œä¾‹å¦‚ï¼š1")

        if not criteria1:
            raise Exception("è¯·å¡«å…¥ç­›é€‰æ¡ä»¶1ï¼Œç¤ºä¾‹ï¼š\">100\"ã€\"Apple\"ã€\"å¼ *\"ã€\">=2023-01-01\"ã€\"10\"ã€\"#FF0000\"ã€\"<>\"ã€‚æ³¨æ„æ”¯æŒé€šé…ç¬¦*")

        if criteria1 == '*' or criteria2 == '*':
            raise Exception("ç­›é€‰æ¡ä»¶ä¸èƒ½ä»…ä¸ºé€šé…ç¬¦*ï¼Œè¯·æä¾›æ›´å…·ä½“çš„æ¡ä»¶!")

        if operator not in ["xlAnd", "xlOr"] and criteria2:
            raise Exception("å½“æ“ä½œç¬¦ä¸é€‰ä¸ºxlAndï¼ˆé€»è¾‘ä¸ï¼‰æˆ–xlOrï¼ˆé€»è¾‘æˆ–ï¼‰æ—¶ï¼Œç¦æ­¢æä¾›æ¡ä»¶2ï¼")

        try:
            file_id = self.session.storage.get("file_id").decode('utf-8')
            token = self.session.storage.get("token").decode('utf-8')
            script_id = self.session.storage.get("script_id").decode('utf-8')

            client = WPSAirScriptClient(file_id=file_id, token=token, script_id=script_id ,base_url=self.session.storage.get("base_url").decode('utf-8'))
            result = client.set_filter(
                field=field,
                operator=operator,
                criteria1=criteria1,
                criteria2=criteria2 if criteria2 else None, # type: ignore
                is_reSet=is_reSet,
                sheet_name=sheet_name # type: ignore
            )

            if result and result[0]['success']:
                pass
            else:
                raise Exception(f"è®¾ç½®ç­›é€‰å¤±è´¥ï¼WPSå®˜æ–¹è¿”å›é”™è¯¯ä¿¡æ¯ï¼š{result}")
        except Exception as e:
            raise Exception(f"è®¾ç½®ç­›é€‰å¤±è´¥ï¼WPSå®˜æ–¹è¿”å›é”™è¯¯ä¿¡æ¯ï¼š{e}")

        yield self.create_text_message("è®¾ç½®ç­›é€‰æˆåŠŸï¼\n")
